{% extends "base/base.html" %}
{% load staticfiles %}

{% block title %}
TECS: Test Essay Checking Software | Home
{% endblock %}

{% block custom_style %}
<head>
<script src="{% static 'base/js/jquery.min.js' %}"></script>
<script src="{% static 'base/js/jquery.hotkeys.js' %}"></script>
<script src="{% static 'base/js/prettify.js' %}"></script>
<link rel="stylesheet" href="{% static 'base/css/jquery.countdown.css' %}">	
<script src="{% static 'base/js/bootstrap-wysiwyg.js' %}"></script>
<link href="{% static 'base/css/flat-ui.css' %}" rel="stylesheet">
<script src="{% static 'base/js/ckeditor.js' %}"></script>
<script type="text/javascript" src="{% static 'base/js/jquery.countdown.js' %}"></script>


<style>
	.noDays { 		
		width: 240px; 
		height: 45px; 
		}
	#editor {
		max-height: 250px;
		height: 250px;
		background-color: white;
		border-collapse: separate; 
		border: 1px solid rgb(204, 204, 204); 
		padding: 4px; 
		box-sizing: content-box; 
		-webkit-box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset; 
		box-shadow: rgba(0, 0, 0, 0.0745098) 0px 1px 1px 0px inset;
		border-top-right-radius: 3px; border-bottom-right-radius: 3px;
		border-bottom-left-radius: 3px; border-top-left-radius: 3px;
		overflow: scroll;
		outline: none;
	}

	#wcount{
	  	color: #34495e;
	  	font-family: "Lato", sans-serif;
	  	font-size: 14px;
		padding: 8px 5px;
		height: 21px;
		text-indent: 6px;
	}
	
	#myModal {	
		width: 50%;
		margin-left: -30%;
		left: 55%;
	}
</style>
</head>
{% endblock %}

{% block content %}
<div class="page-content">
	<div id="myModal" data-backdrop="static" data-keyboard="false" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	  <div class="modal-body" style="background-color: rgb(241, 196, 15); ">
				 <h3>Log-in to resume taking the exam.</h3>
				  <div class="login-form">
					<div class="control-group">
						<input type="text" class="login-field span4" value="" placeholder="Enter your username" id="login-name" />
						<label class="login-field-icon fui-user" for="login-name"></label>
					</div>

					<div class="control-group">
						<input type="password" class="login-field span4" value="" placeholder="Password" id="login-pass" />
						<label class="login-field-icon fui-lock" for="login-pass"></label>
					</div>

					<a class="btn btn-inverse btn-large btn-block" data-dismiss="modal" aria-hidden="true" >Login</a>
					<a class="login-link" href="#">Forgot your password?</a>
				</div>
		</div>
	</div>
	<div class="span10">
		<div class="row-fluid">
			<div class="span12 content">
				<div class="row-fluid">
					<div class="span8">
						<img class="title-icons" src={% static 'base/img/icons/Chat@2x.png' %}>
						<h3 class="title">Answer Exam</h3>
					</div>
					<div class="span4">
						<span class="noDays btn btn-danger pull-right"></span>
					</div>
				</div>
				<form class="form-horizontal" action="" method="post">
					{% csrf_token %}
					<fieldset>	
						  <div class="control-group">  
							<label class="control-label" for="title">Exam Title</label>  
							<div class="controls">  
							  <p id = "title">{{ essay_response.essay.title }}</p>
							</div>  
						  </div>  
						  					  
						  <div class="control-group">  
							<label class="control-label" for="inst">Instructions</label>  
							<div class="controls">  
							  <p id ="inst">{{ essay_response.essay.instructions }}</p> 
							</div>  
						  </div>
							
						<div class="control-group">  
							<label class="control-label" for="inputduration">Duration</label>
							<div class="controls">  
							  {{ essay_response.essay.duration_hours }} hr(s) {% if essay_response.essay.duration_minutes > 0%} {{ essay_response.essay.duration_minutes }} min(s) {% endif %}
							</div>  
						</div>

						<div class="control-group">  
							<label class="control-label" for="inputduration">Response</label>
							<div class="controls">
								<div class="span3 pull-right">
									<input class="wcount span3" type="text" id="word_count" disabled="" value="Word Count: 0"> 
								</div>
								{{ form.response }}
							</div>  
						</div>

					  <div class="form-actions">  
						<button name="draft" type="submit" class="btn btn-primary"><b>Save Draft</b> <i class="fui-new"></i></button> 
						<button name="final" type="submit" class="btn btn-warning"><b>Submit</b> <i class="fui-check"></i></button> 
						<a href="#myModal" role="button" data-toggle="modal" class="btn btn-danger"><b>Lock</b><i class="fui-lock"></i></a>
					  </div>   
					</fieldset>
				</form>
			</div>
		</div>
	</div>
</div>

<script>
	function confirmation(){
		var r=confirm("Are you sure you want to submit? You can no longer edit your essay if you click 'OK'.");
		if (r==true){
		  x="You pressed OK!"; //go to home
		}
	}
</script>

<script type="text/javascript">
$(function () {
	//var austDay = new Date();
	//austDay = new Date(austDay.getFullYear() + 1, 1 - 1, 26);
	//$('#noDays').countdown({until: austDay});
	var liftoffTime = {{ essay_response.time_remaining }};
	$('.noDays').countdown({until: liftoffTime, format: 'HMS'});
});
</script>

<script>
  $(function(){
	function initToolbarBootstrapBindings() {
	  var fonts = ['Serif', 'Sans', 'Arial', 'Arial Black', 'Courier', 
			'Courier New', 'Comic Sans MS', 'Helvetica', 'Impact', 'Lucida Grande', 'Lucida Sans', 'Tahoma', 'Times',
			'Times New Roman', 'Verdana'],
			fontTarget = $('[title=Font]').siblings('.dropdown-menu');
	  $.each(fonts, function (idx, fontName) {
		  fontTarget.append($('<li><a data-edit="fontName ' + fontName +'" style="font-family:\''+ fontName +'\'">'+fontName + '</a></li>'));
	  });
	  $('a[title]').tooltip({container:'body'});
		$('.dropdown-menu input').click(function() {return false;})
			.change(function () {$(this).parent('.dropdown-menu').siblings('.dropdown-toggle').dropdown('toggle');})
		.keydown('esc', function () {this.value='';$(this).change();});

	  $('[data-role=magic-overlay]').each(function () { 
		var overlay = $(this), target = $(overlay.data('target')); 
		overlay.css('opacity', 0).css('position', 'absolute').offset(target.offset()).width(target.outerWidth()).height(target.outerHeight());
	  });
	  if ("onwebkitspeechchange"  in document.createElement("input")) {
		var editorOffset = $('#editor').offset();
		$('#voiceBtn').css('position','absolute').offset({top: editorOffset.top, left: editorOffset.left+$('#editor').innerWidth()-35});
	  } else {
		$('#voiceBtn').hide();
	  }
	};
	function showErrorAlert (reason, detail) {
		var msg='';
		if (reason==='unsupported-file-type') { msg = "Unsupported format " +detail; }
		else {
			console.log("error uploading file", reason, detail);
		}
		$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button>'+ 
		 '<strong>File upload error</strong> '+msg+' </div>').prependTo('#alerts');
	};
	initToolbarBootstrapBindings();  
	$('#editor').wysiwyg({ fileUploadError: showErrorAlert} );
	window.prettyPrint && prettyPrint();
  });
</script>

<script>
var output = document.getElementById('word_count');
var count =0;

function wordcount(inputwords) {
	console.log(('#id_response').value);
	inputwords = ('#id_response').value;
	var essay = inputwords.split(/\s+/);
	count = essay.length;
	alert(count);
};
	output.setAttribute('value', 'Word Count: '+count);

</script>

<script>
	function count(){
	  var txtVal = $('#id_response').val();
	  var words = txtVal.trim().replace(/\s+/gi, ' ').split(' ').length;
	  var chars = txtVal.length;
	  if(chars===0){words=0;}
	  output.setAttribute('value', 'Word Count: '+words);
	}

	$('#id_response').on('keyup propertychange', function(){ 
		count();
	});
</script>
{% endblock %}
